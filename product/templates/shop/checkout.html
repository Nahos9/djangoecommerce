{% extends 'base.html' %}

{% block content %}

<div class="container">
    <div class="row pt-4">
        <div class="col-md-12">
            <p class="text-center bg-success text-white fs-4">Mon panier</p>
            <ul  id="list-items" class="list-group">
               
                
            </ul>
        </div>
    </div>
    <div class="row pt-3">
        <div class="col-md-12">
            <form method="POST">
                {% csrf_token %}
                <p class="text-center fs-4 bg-success text-white">Formulaire de commande</p>
                <div class="form-row row pt-3">
                    <input type="hidden" id="items" name="items">
                  <div class="form-group col-md-6">
                    <!-- <label for="inputEmail4">Votre nom</label> -->
                    <input type="text" class="form-control" id="nom" name="nom" placeholder="Votre nom">
                  </div>
                  <div class="form-group col-md-6">
                    <!-- <label for="inputPassword4">Votre email</label> -->
                    <input type="email" class="form-control" id="email" name="email" placeholder="Votre email">
                  </div>
                </div>
                <div class="form-group pt-3">
                  <!-- <label for="inputAddress">Address</label> -->
                  <input type="text" class="form-control" id="adresse" name="adresse" placeholder="Adresse">
                </div>
                <div class="form-row row pt-3 pb-3">
                  <div class="form-group col-md-6">
                    <input type="text" class="form-control" id="ville" name="ville" placeholder="Ville"> 
                  </div>
                  <div class="form-group col-md-4">
                    <select id="pays" name="pays" class="form-control">
                      <option selected>Pays</option>
                      <option>Senegal</option>
                      <option>Gambie</option>
                      <option>Cote d'ivoir</option>
                      <option>Gabon</option>
                      <option>Cameroun</option>
                    </select>
                  </div>
                </div>
                <div class="form-row row pb-3">
                    <div class="form-group col-md-6">
                        <input type="text" class="form-control" id="zip" name="zip" placeholder="Zip">
                    </div>
                    <div class="form-group col-md-6">
                        <input type="readonly" class="form-control bg-danger text-white"  id="totalprice" name="total" placeholder="Prix total">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary mb-3">Commander</button>
              </form>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}

<script type="text/javascript">

    if(localStorage.getItem('panier')== null){
        let panier = {};
    }else{
        panier = JSON.parse(localStorage.getItem('panier'));
    }
    let totalQ = 0
    let totalPrice = 0
    for(item in panier){

        let title = panier[item][1];
        let quantite = panier[item][0];
        totalQ +=quantite
        let price = panier[item][2]
        totalPrice +=price

        let itemstring = `<li class="list-group-item d-flex justify-content-between text-black align-items-start">
                        ${title}
                    <span class="badge bg-primary rounded-pill">Qte: ${quantite}</span>
                  <span class="badge bg-success rounded-pill">$ ${price}</span>
                </li>`;

                $('#list-items').append(itemstring);
            }
        let totalString = `<li class="list-group-item d-flex justify-content-between text-black align-items-start">
                        <b class="fs-6 bg-info"> Quantite && PRIX TOTAL </b>
                    <span class="badge bg-primary rounded-pill">Qte: ${totalQ}</span>
                  <span class="badge bg-danger rounded-pill">$ ${totalPrice}</span>
                </li>`;
            $('#list-items').append(totalString);
            $('#totalprice').val("$"+totalPrice)
    $('#items').val(JSON.stringify(panier))
</script>
{% endblock %}